<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>IntelliMaint - Login</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body style="display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, #0f2027, #203a43, #2c5364);">

<div class="panel" style="width: 400px; text-align: center; padding: 40px;">
  <h1 style="margin-bottom: 20px; color: #00e5ff;">ðŸ›  IntelliMaint</h1>
  <h2 style="margin-bottom: 30px; font-size: 1.2em; color: #cfeefb;">Secure Login</h2>

  <form id="loginForm">
    <div style="margin-bottom: 15px; text-align: left;">
      <label style="color: #88ccff;">Username</label>
      <input type="text" id="username" required style="width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid #444; color: white; border-radius: 6px;">
    </div>

    <div style="margin-bottom: 15px; text-align: left;">
      <label style="color: #88ccff;">Role</label>
      <select id="role" style="width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid #444; color: white; border-radius: 6px;">
        <option value="Employee">Employee</option>
        <option value="Admin">Admin</option>
      </select>
    </div>

    <div style="margin-bottom: 25px; text-align: left;">
      <label style="color: #88ccff;">Password</label>
      <input type="password" id="password" required style="width: 100%; padding: 12px; background: rgba(0,0,0,0.3); border: 1px solid #444; color: white; border-radius: 6px;">
    </div>

    <button type="submit" style="font-size: 1.1em;">Login</button>
  </form>

  <p style="margin-top: 20px; font-size: 0.9em; color: #cfeefb;">
    Don't have an account? <a href="register.html" style="color: #ff6b6b; text-decoration: none; font-weight: bold;">Register here</a>
  </p>
  
  <div id="errorMsg" style="color: #ff4757; margin-top: 15px; display: none;"></div>
</div>

<script>
  // Theme Logic
  const style = document.createElement('style');
  style.innerHTML = `
    body.light-mode { background: #f0f2f5 !important; color: #333 !important; }
    body.light-mode .panel { background: #fff !important; border: 1px solid #ccc !important; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
    body.light-mode h1, body.light-mode h2 { color: #111 !important; }
    body.light-mode label { color: #555 !important; }
    body.light-mode input { background: #fff !important; color: #333 !important; border: 1px solid #ccc !important; }
  `;
  document.head.appendChild(style);
  if (localStorage.getItem('theme') === 'light') document.body.classList.add('light-mode');

  // Initialize default users if empty
  if (!localStorage.getItem('users')) {
    const defaultUsers = [
      { username: 'admin', password: 'password', role: 'Admin' },
      { username: 'emp', password: 'password', role: 'Employee' }
    ];
    localStorage.setItem('users', JSON.stringify(defaultUsers));
    console.log("Default users created: admin/password");
  }

  // Redirect if already logged in
  if (sessionStorage.getItem('currentUser')) {
    window.location.href = 'index.html';
  }

  document.getElementById('loginForm').addEventListener('submit', function(e) {
    e.preventDefault();
    const userIn = document.getElementById('username').value;
    const roleIn = document.getElementById('role').value;
    const passIn = document.getElementById('password').value;
    const errorMsg = document.getElementById('errorMsg');

    const users = JSON.parse(localStorage.getItem('users')) || [];
    const validUser = users.find(u => u.username === userIn && u.password === passIn && u.role === roleIn);

    if (validUser) {
      sessionStorage.setItem('currentUser', JSON.stringify(validUser));
      errorMsg.style.display = 'none';
      // Simulate loading
      const btn = document.querySelector('button');
      btn.innerText = "Authenticating...";
      setTimeout(() => {
        window.location.href = 'index.html';
      }, 800);
    } else {
      errorMsg.innerText = "Invalid username or password";
      errorMsg.style.display = 'block';
    }
  });
</script>

</body>
</html>